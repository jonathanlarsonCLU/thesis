---
title: "dbtstmetaanalysis"
author: "Jonathan"
date: "January 15, 2018"
output: pdf_document
---

# Load packages
```{r}
#install.packages("metafor")
library("metafor")

#install.packages("compute.es")
library("compute.es")

#install.packages("MAd")
library("MAd")

#install.packages("readxl")
library("readxl")

```

# Load data
```{r}
# study id, author, year, outcome, test, treatment mean, treatment standard deviation, treatment n, control mean, control standard deviation, control n
dbtst_raw <- read_excel("larson(raw_ma).xlsx")
View(dbtst_raw)

# study id, author, year, outcome, test, treatment n, control n, hedge's g, variance of hedge's g, p-value of hedge's g
dbtst_es <- read_excel("larson(es_ma).xlsx")
View(dbtst_es)


```


# Calculate effect sizes 
```{r}
# The following random-effects meta analysis will follow steps provided from A. C. Del Re's article: "A Practicial Tutorial on Conducting Meta-Analysis in R" to compute Hedge's g effect sizes of Dialetical Behavior Therapy Skills Trainning outcomes. However, unlike A. C. Rel Re's tutorial, moderators were not incorported into the analysis.


res1 <- mes(m.1 = m1T, m.2 = m1C, sd.1 = sd1T, sd.2 = sd1C, n.1 = nT, n.2 = nC, id = id, data = dbtst_raw)

# View data
res1


```


# Aggregating dependent effect sizes
```{r}
# Given that studies may report multiple outcome measures, aggregating them prior to analysis is necessary so that each independent sample (study) contributes only a single ES


dbtst_agg <- agg(id = id, es = g, var = var.g, n.1 = nT, n.2 = nC, cor = 0.5, method = "BHHR", data = dbtst_es)

# View aggregated data
dbtst_agg
```

# Estimating summary effect


# Forest-Plot of All Outcomes
```{r}
forest(rma_model, slab = paste(dbtst$study, as.character(dbtst$year), sep = ", "))

# Need to report particular outcomes: anxiety, depression, etc





```

# Boxplot to seperate outcomes across studies 
```{r}
boxplot(yi ~ outcome, data = dbtst)


```

# Funnel Plot
```{r}
# A common way to investigate potential publication bias in a meta-analysis is the funnel plot, asymmetrical distribution indicates potential publication bias


### decrease margins so the full space is used
par(mar=c(5,4,1,2))
 
### fit random-effects model
res <- rma(yi, vi, data=dbtst, measure="SMD")
 
### carry out trim-and-fill analysis
taf <- trimfill(res)
 
### draw funnel plot with missing studies filled in
funnel(taf)


```












# 